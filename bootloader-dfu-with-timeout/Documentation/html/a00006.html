<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>LUFA Library - DFU Class Bootloader: BootloaderDFU.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - DFU Class Bootloader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00006.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">BootloaderDFU.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="a00007.html">BootloaderDFU.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a60afc7213e2c9632f48acdcf4b5213c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a60afc7213e2c9632f48acdcf4b5213c3">Application_Jump_Check</a> (void)</td></tr>
<tr class="separator:a60afc7213e2c9632f48acdcf4b5213c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b2455ced7174a736a4c4ef730fa078e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a0b2455ced7174a736a4c4ef730fa078e">SetupHardware</a> (void)</td></tr>
<tr class="separator:a0b2455ced7174a736a4c4ef730fa078e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff4dd9ef18deaf99078a09fbd6b1192"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a8ff4dd9ef18deaf99078a09fbd6b1192">ResetHardware</a> (void)</td></tr>
<tr class="separator:a8ff4dd9ef18deaf99078a09fbd6b1192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4bb889d011ea82c5218b8d671716f51"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#ae4bb889d011ea82c5218b8d671716f51">ISR</a> (TIMER1_OVF_vect, ISR_BLOCK)</td></tr>
<tr class="separator:ae4bb889d011ea82c5218b8d671716f51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f4ce439a74a152e3c8ffda5c7dd201a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a3f4ce439a74a152e3c8ffda5c7dd201a">EVENT_USB_Device_ControlRequest</a> (void)</td></tr>
<tr class="separator:a3f4ce439a74a152e3c8ffda5c7dd201a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f5dda4a64d21500166199780fe00ef3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a9f5dda4a64d21500166199780fe00ef3">DiscardFillerBytes</a> (uint8_t NumberOfBytes)</td></tr>
<tr class="separator:a9f5dda4a64d21500166199780fe00ef3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4df8b3dc9e9038f2544560b6b643967e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a4df8b3dc9e9038f2544560b6b643967e">ProcessBootloaderCommand</a> (void)</td></tr>
<tr class="separator:a4df8b3dc9e9038f2544560b6b643967e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afee764fe0d913307b86189d47320c593"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#afee764fe0d913307b86189d47320c593">LoadStartEndAddresses</a> (void)</td></tr>
<tr class="separator:afee764fe0d913307b86189d47320c593"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a6121c0ac69f5d1ffc61cf8a374342f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a2a6121c0ac69f5d1ffc61cf8a374342f">ProcessMemProgCommand</a> (void)</td></tr>
<tr class="separator:a2a6121c0ac69f5d1ffc61cf8a374342f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08bc226c90c59450e1d1697d803a8c25"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a08bc226c90c59450e1d1697d803a8c25">ProcessMemReadCommand</a> (void)</td></tr>
<tr class="separator:a08bc226c90c59450e1d1697d803a8c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabcf53cda782ea6a288c5a211e203c7b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#aabcf53cda782ea6a288c5a211e203c7b">ProcessWriteCommand</a> (void)</td></tr>
<tr class="separator:aabcf53cda782ea6a288c5a211e203c7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a554e0de597375c2c3537d744df715812"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a554e0de597375c2c3537d744df715812">ProcessReadCommand</a> (void)</td></tr>
<tr class="separator:a554e0de597375c2c3537d744df715812"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adb59d1044fe46ad2ddd774ccbc267db1"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#adb59d1044fe46ad2ddd774ccbc267db1">IsSecure</a> = <a class="el" href="a00009.html#ab881446fded4428bab20319352b91afa">SECURE_MODE</a></td></tr>
<tr class="separator:adb59d1044fe46ad2ddd774ccbc267db1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a997cfdd9124b3e2f863a83f7f7d71c35"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a997cfdd9124b3e2f863a83f7f7d71c35">RunBootloader</a> = true</td></tr>
<tr class="separator:a997cfdd9124b3e2f863a83f7f7d71c35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79938ee4d6c97ef16aef52355eb1f229"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a79938ee4d6c97ef16aef52355eb1f229">WaitForExit</a> = false</td></tr>
<tr class="separator:a79938ee4d6c97ef16aef52355eb1f229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4736947410e7563e2984f3399e635667"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a4736947410e7563e2984f3399e635667">DFU_State</a> = <a class="el" href="a00007.html#a97def58441af684d35dc81a34e0c1acea64a13d4b1b2cc0b0a40069d8c28fe74c">dfuIDLE</a></td></tr>
<tr class="separator:a4736947410e7563e2984f3399e635667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ba29b60ec9525673c1c476d302a14df"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a2ba29b60ec9525673c1c476d302a14df">DFU_Status</a> = <a class="el" href="a00007.html#a4489e781155c461e0e31910418244f27a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a></td></tr>
<tr class="separator:a2ba29b60ec9525673c1c476d302a14df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f9868e32fbd58a184c112f509ed7f6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="a00001.html">DFU_Command_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a40f9868e32fbd58a184c112f509ed7f6">SentCommand</a></td></tr>
<tr class="separator:a40f9868e32fbd58a184c112f509ed7f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a185062f4b63cb73b9c4b825d6f5951bb"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a185062f4b63cb73b9c4b825d6f5951bb">ResponseByte</a></td></tr>
<tr class="separator:a185062f4b63cb73b9c4b825d6f5951bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a167b0a1aebd4b4dd2185eb415b21e546"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="a00007.html#af456875920c8c853098d9c2f247c32af">AppPtr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a167b0a1aebd4b4dd2185eb415b21e546">AppStartPtr</a> = (<a class="el" href="a00007.html#af456875920c8c853098d9c2f247c32af">AppPtr_t</a>)0x0000</td></tr>
<tr class="separator:a167b0a1aebd4b4dd2185eb415b21e546"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96d39e5cbd62a6788cb4914cd949f12a"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a96d39e5cbd62a6788cb4914cd949f12a">Flash64KBPage</a> = 0</td></tr>
<tr class="separator:a96d39e5cbd62a6788cb4914cd949f12a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4661ab0f171fdfe2d86b3b7f6e156a0"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#ac4661ab0f171fdfe2d86b3b7f6e156a0">StartAddr</a> = 0x0000</td></tr>
<tr class="separator:ac4661ab0f171fdfe2d86b3b7f6e156a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ef861a8b23d4393f6cb3f7880c1f720"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a1ef861a8b23d4393f6cb3f7880c1f720">EndAddr</a> = 0x0000</td></tr>
<tr class="separator:a1ef861a8b23d4393f6cb3f7880c1f720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad98754cd5b9bd2d564fd093c20b07e2d"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#ad98754cd5b9bd2d564fd093c20b07e2d">MagicBootKey</a></td></tr>
<tr class="separator:ad98754cd5b9bd2d564fd093c20b07e2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main source file for the DFU class bootloader. This file contains the complete bootloader logic. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a60afc7213e2c9632f48acdcf4b5213c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Application_Jump_Check </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Special startup routine to check if the bootloader was started via a watchdog reset, and if the magic application start key has been loaded into <a class="el" href="a00006.html#ad98754cd5b9bd2d564fd093c20b07e2d">MagicBootKey</a>. If the bootloader started via the watchdog and the key is valid, this will force the user application to start via a software jump. </p>

</div>
</div>
<a class="anchor" id="a9f5dda4a64d21500166199780fe00ef3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void DiscardFillerBytes </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>NumberOfBytes</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routine to discard the specified number of bytes from the control endpoint stream. This is used to discard unused bytes in the stream from the host, including the memory program block suffix.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NumberOfBytes</td><td>Number of bytes to discard from the host from the control endpoint </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3f4ce439a74a152e3c8ffda5c7dd201a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_ControlRequest </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event handler for the USB_ControlRequest event. This is used to catch and process control requests sent to the device from the USB host before passing along unhandled control requests to the library for processing internally. </p>

</div>
</div>
<a class="anchor" id="ae4bb889d011ea82c5218b8d671716f51"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">TIMER1_OVF_vect&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ISR_BLOCK&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>ISR to periodically toggle the LEDs on the board to indicate that the bootloader is active. </p>

</div>
</div>
<a class="anchor" id="afee764fe0d913307b86189d47320c593"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void LoadStartEndAddresses </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routine to concatenate the given pair of 16-bit memory start and end addresses from the host, and store them in the StartAddr and EndAddr global variables. </p>

</div>
</div>
<a class="anchor" id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Main program entry point. This routine configures the hardware required by the bootloader, then continuously runs the bootloader processing routine until instructed to soft-exit, or hard-reset via the watchdog to start the loaded application code. </p>

</div>
</div>
<a class="anchor" id="a4df8b3dc9e9038f2544560b6b643967e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ProcessBootloaderCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routine to process an issued command from the host, via a DFU_DNLOAD request wrapper. This routine ensures that the command is allowed based on the current secure mode flag value, and passes the command off to the appropriate handler function. </p>

</div>
</div>
<a class="anchor" id="a2a6121c0ac69f5d1ffc61cf8a374342f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ProcessMemProgCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handler for a Memory Program command issued by the host. This routine handles the preparations needed to write subsequent data from the host into the specified memory. </p>

</div>
</div>
<a class="anchor" id="a08bc226c90c59450e1d1697d803a8c25"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ProcessMemReadCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handler for a Memory Read command issued by the host. This routine handles the preparations needed to read subsequent data from the specified memory out to the host, as well as implementing the memory blank check command. </p>

</div>
</div>
<a class="anchor" id="a554e0de597375c2c3537d744df715812"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ProcessReadCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handler for a Data Read command issued by the host. This routine handles bootloader information retrieval commands such as device signature and bootloader version retrieval. </p>

</div>
</div>
<a class="anchor" id="aabcf53cda782ea6a288c5a211e203c7b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ProcessWriteCommand </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handler for a Data Write command issued by the host. This routine handles non-programming commands such as bootloader exit (both via software jumps and hardware watchdog resets) and flash memory erasure. </p>

</div>
</div>
<a class="anchor" id="a8ff4dd9ef18deaf99078a09fbd6b1192"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ResetHardware </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Resets all configured hardware required for the bootloader back to their original states. </p>

</div>
</div>
<a class="anchor" id="a0b2455ced7174a736a4c4ef730fa078e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void SetupHardware </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Configures all hardware required for the bootloader. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a167b0a1aebd4b4dd2185eb415b21e546"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00007.html#af456875920c8c853098d9c2f247c32af">AppPtr_t</a> AppStartPtr = (<a class="el" href="a00007.html#af456875920c8c853098d9c2f247c32af">AppPtr_t</a>)0x0000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pointer to the start of the user application. By default this is 0x0000 (the reset vector), however the host may specify an alternate address when issuing the application soft-start command. </p>

</div>
</div>
<a class="anchor" id="a4736947410e7563e2984f3399e635667"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t DFU_State = <a class="el" href="a00007.html#a97def58441af684d35dc81a34e0c1acea64a13d4b1b2cc0b0a40069d8c28fe74c">dfuIDLE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Current DFU state machine state, one of the values in the DFU_State_t enum. </p>

</div>
</div>
<a class="anchor" id="a2ba29b60ec9525673c1c476d302a14df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t DFU_Status = <a class="el" href="a00007.html#a4489e781155c461e0e31910418244f27a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Status code of the last executed DFU command. This is set to one of the values in the DFU_Status_t enum after each operation, and returned to the host when a Get Status DFU request is issued. </p>

</div>
</div>
<a class="anchor" id="a1ef861a8b23d4393f6cb3f7880c1f720"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t EndAddr = 0x0000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Memory end address, indicating the end address to read from/write to in the memory being addressed (either FLASH of EEPROM depending on the issued command from the host). </p>

</div>
</div>
<a class="anchor" id="a96d39e5cbd62a6788cb4914cd949f12a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Flash64KBPage = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>64-bit flash page number. This is concatenated with the current 16-bit address on USB AVRs containing more than 64KB of flash memory. </p>

</div>
</div>
<a class="anchor" id="adb59d1044fe46ad2ddd774ccbc267db1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool IsSecure = <a class="el" href="a00009.html#ab881446fded4428bab20319352b91afa">SECURE_MODE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Flag to indicate if the bootloader is currently running in secure mode, disallowing memory operations other than erase. This is initially set to the value set by SECURE_MODE, and cleared by the bootloader once a memory erase has completed in a bootloader session. </p>

</div>
</div>
<a class="anchor" id="ad98754cd5b9bd2d564fd093c20b07e2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t MagicBootKey</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Magic lock for forced application start. If the HWBE fuse is programmed and BOOTRST is unprogrammed, the bootloader will start if the /HWB line of the AVR is held low and the system is reset. However, if the /HWB line is still held low when the application attempts to start via a watchdog reset, the bootloader will re-start. If set to the value <a class="el" href="a00007.html#a77b3cb845202cca18b5ed20ff89b4a7e">MAGIC_BOOT_KEY</a> the special init function <a class="el" href="a00006.html#a60afc7213e2c9632f48acdcf4b5213c3">Application_Jump_Check()</a> will force the application to start. </p>

</div>
</div>
<a class="anchor" id="a185062f4b63cb73b9c4b825d6f5951bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ResponseByte</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Response to the last issued Read Data DFU command. Unlike other DFU commands, the read command requires a single byte response from the bootloader containing the read data when the next DFU_UPLOAD command is issued by the host. </p>

</div>
</div>
<a class="anchor" id="a997cfdd9124b3e2f863a83f7f7d71c35"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool RunBootloader = true</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Flag to indicate if the bootloader should be running, or should exit and allow the application code to run via a soft reset. When cleared, the bootloader will abort, the USB interface will shut down and the application jumped to via an indirect jump to location 0x0000 (or other location specified by the host). </p>

</div>
</div>
<a class="anchor" id="a40f9868e32fbd58a184c112f509ed7f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00001.html">DFU_Command_t</a> SentCommand</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Data containing the DFU command sent from the host. </p>

</div>
</div>
<a class="anchor" id="ac4661ab0f171fdfe2d86b3b7f6e156a0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t StartAddr = 0x0000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Memory start address, indicating the current address in the memory being addressed (either FLASH or EEPROM depending on the issued command from the host). </p>

</div>
</div>
<a class="anchor" id="a79938ee4d6c97ef16aef52355eb1f229"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool WaitForExit = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Flag to indicate if the bootloader is waiting to exit. When the host requests the bootloader to exit and jump to the application address it specifies, it sends two sequential commands which must be properly acknowledged. Upon reception of the first the RunBootloader flag is cleared and the WaitForExit flag is set, causing the bootloader to wait for the final exit command before shutting down. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00006.html">BootloaderDFU.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
